---
title: "TPF Facegen"
weight: 6
type: docs
description: >
  Documentation for TPF facegen.
---

## Preamble

**This page does not contain instructions.** It is merely documentation for how I did facegen for me to refer back to because I'm forgetful (and maybe it's also a nice resource for users). You don't have to do any of this, freshly generated facegen for TPF is provided for you in the main guide / Wabbajack installer.

Until TPF 4.6, generating facegen *was* part of the main guide. However, because the generation of facegen became progressively more complicated, I chose to remove this step from the guide and simply provide premade facegen for everyone.

### About facegen

Among the most common “bugs” in Skyrim is the dreaded “black face” which is simply mismatched facegen. NPC heads - specifically tintmasks like dirt, warpaints, makeup - are defined in their records (in the official master files and sometimes other mods that change them) but there must be matching textures and meshes present as well. The “black face” occurs when the facegen files (aforementioned textures and meshes) do not match the NPC record. The facegen files are generated by the Creation Kit.

TPF is using a number of mods to improve NPC appearance. However, by default many of these mods will only affect the player character and facegen must be regenerated with those mods so that they can apply to NPCs as well. This is why I have to regenerate facegen not only for all vanilla NPCs but also for NPCs added by mods for consistent and high quality facegen across the board.

The process of creating facegen was significantly simplified by **Nuukem’s Creation Kit Fixes** and **VictorF’s zEdit script**.

## Preparations

By default the Creation Kit will generate facetint textures with a 512x512 resolution. Thanks to CK Fixes I can easily increase the resolution for higher quality output.

- Navigate to your **root** folder.
- Double-click **skyrim64_test.ini**.
- Scroll to **Line 33** and change the line to `TintMaskResolution=1024`.
- Save the file and close.

## Facegen Plugins

Regenerating facegen is easiest with a plugin containing all NPC records which I generated in zEdit using [VictorF's NPCsWithFaces script](https://www.nexusmods.com/skyrimspecialedition/mods/26092). I have split up the plugin into the following "modules":

- The bulk of all vanilla NPCs are in the main plugin.
- Snow Elves should, for some reason, be generated separately to avoid broken facegen on other NPCs.
- There is also a separate "Mod Added NPCs" facegen plugin for all non-vanilla NPCs.

SimpleVampFixesSSE.esp (from Skyrim Ruhmastered Eyemeshes) and NaturalHairColors.esp were added as additional masters to all facegen plugins so they are loaded automatically by the CK and their changes are applied to the new facegen.

## Regenerating Facegen

Thanks to the premade plugins, regenerating facegen is a breeze.

- Run the Creation Kit through Steam.
- Go to **File** » **Data** and scroll all the way to the bottom of the load order in the left pane.
- Select **The Phoenix Flavour - Facegen - Vanilla NPCs.esp** and **Set as Active File**.
- Click **OK** and wait for the Creation Kit to load all plugins.
- In the list of record types on the left, expand **Actors** and select **Actor**.
- Check the box for **Show only active (*) forms**.
- Regenerate facegen in batches by highlighting a few dozen NPCs at a time and pressing **CTRL+F4**.
- Progress can be checked in the log window (ignore the warnings).
- Wait until a window pops up that simply says **Done**.
- Once facegen for all NPCs was regenerated, close the Creation Kit.

> The option to filter for active forms is added by CK Fixes and it’s ingenious. Checking it will make it so only records touched by the current active plugin are displayed which means we only see NPC records filtered out earlier in zEdit into the NPCsWithFaces plugin.

### Asset Management

- Back in MO2, the new meshes and textures will be in the ***Overwrite***.
- Right-click it, select **Create mod**, and enter **The Phoenix Flavour - Facegen** as the name.
- Go back into the Creation Kit and generate facegen for the remaining plugins.
- In between plugins, dump the generated facegen files into the newly created mod.

## Optimisation

Once all meshes and textures have been generated and consolidated in one folder, run Cathedral Assets Optimizer with the **Optimise Facegen** profile on all files. This will pack all assets into a BSA with a matching plugin to save space.